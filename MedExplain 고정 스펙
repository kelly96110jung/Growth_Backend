| 항목                           | 내용                       |
| ---------------------------- | ------------------------ |
| **0) 기본 전제**                 | • Streaming Recognize 사용 |
| • 서버가 스트리밍 세션을 관리            |                          |
| • Gemini API Key 사용          |                          |
| • 상용화 목적 ❌ (저장 OK, 약관 동의 기반) |                          |
| **1) 대상 / 사용자 / 진료과**        | **1차 진료과**               |
| • 성형외과                       |                          |
사용자
• 성형외과 진료를 받는 일반인
• 외국인 환자 (영어 / 중국어)
• 의료 통역사 보조 용도 |
| 2) 시간 / 성능 / 녹음 규칙 | 상담 시간
• 기본 5분
• 최대 20분

스트리밍 관리 방식
• 내부적으로 30초 내외 ~ 최대 1분 세그먼트 단위 관리

성능 목표
• 5초 내 결과
• 최소한 출력1(원문 전사)은 5초 내 표시 |
| 3) 출력 정의 (고정) | 출력1 (원문)
• Streaming STT 결과
• Interim(부분 전사) / Final(확정 전사) 구분
• 언어 그대로 표시 (ko / en / zh 혼용 가능)

출력2 (변환본, 1차 필수 구성)
• 번역문
• 1차 범위: 의사 ko → 환자 en / zh
• 용어 글로스 (사전 기반, 원문 병기)
• 의학용어는 번역하지 않고 원문 유지
• 뜻은 별도 카드로 제공

모르는 용어 처리
• 사전에 없거나 확신 없는 용어
• 빨간색 표시
• 라벨: 확인 필요 |
| 4) 모드 설계 | 모드 A: 환자 이해 모드
입력
• 의사 한국어 (+영문 의학용어)

출력2
• 용어 글로스
• (확장 슬롯) 쉬운 말 설명 / 요약

모드 B: 외국인 의사소통 모드 (1차 확정)
방향
• 의사 ko → 환자 en / zh

출력2
• 번역문
• 용어 글로스
• 빨간색 “확인 필요” 용어 표시 |
| 5) 품질 정책 (절대 규칙) | • 정확도 > 안정성 > 자연스러움

확실하지 않으면
• 억지로 번역 ❌
• 경고 + 원문 유지 ⭕ |
| 6) 스트리밍 + 세션 운영 규칙 (서버 세션 관리형) | 세션
• 최대 20분
• 세그먼트 단위 누적 관리

네트워크 재시도
• 스트리밍 중 연결 끊기면 서버가 세션 유지
• 자동 재시도

UI 표시
• 연결 끊김 → 재연결 중 (1/3)

재시도 실패 시
• 해당 세그먼트 전사 불완전 처리
• warnings에 기록 |
| 7) 전체 아키텍처 (확정) | Flutter App
• 마이크 입력
• 오디오 스트림 전송
• 출력1 / 출력2 UI 표시

→ 우리 서버
• 스트리밍 세션 관리
• Google STT Streaming
• 사전 기반 용어 매칭
• 번역 (ko → en / zh)
• Gemini 확장 슬롯

→ 응답 이벤트
• stt_interim
• stt_final
• transform_ready
• warning |
| 8) API 계약 (고정) | POST /session/start
mode: A | B
source_lang: ko
target_lang: en | zh
department: plastic_surgery

POST /session/{id}/audio
• body: 오디오 스트림 청크
• 서버가 STT 스트리밍 세션에 전달

이벤트 표준
type: stt_interim | stt_final | transform_ready | warning
text: string
segment_id: string
timestamp_ms: number

POST /session/{id}/end 응답 포함
• output1_transcript
• output2.translation
• output2.terms_found
• output2.terms_unknown
• output2.warnings |
| 9) A / B / C 역할 (최종) | A (모바일)
• 스트리밍 녹음 / UI
• 세션 시작 / 종료
• Interim / Final 표시
• output1 / output2 화면
• 빨간색 “확인 필요” UX

B (서버)
• 스트리밍 세션 관리
• Google STT 옵션 프리셋
• 사전 기반 용어 매칭
• 번역 파이프라인
• Gemini API 확장 슬롯

C (UX / 데모)
• 성형외과 시나리오 3개
• 외국인 모드 사용 흐름 정리
• 약관 / 동의 화면
• 발표용 스토리라인 |
