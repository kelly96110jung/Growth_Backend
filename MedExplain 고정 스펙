| 항목                                 | 내용                                                                                                                                                                                                                                                                                                                                |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------- | --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **0) 기본 전제**                       | • Streaming Recognize 사용<br>• 서버가 스트리밍 세션을 관리<br>• Gemini API Key 사용<br>• 상용화 목적 ❌ (저장 OK, 약관 동의 기반)                                                                                                                                                                                                                              |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **1) 대상 / 사용자 / 진료과**              | **1차 진료과**: 성형외과<br><br>**사용자**:<br>• 성형외과 진료를 받는 일반인<br>• 외국인 환자(영어/중국어)<br>• 의료 통역사 보조 용도                                                                                                                                                                                                                                       |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **2) 시간 / 성능 / 녹음 규칙**             | **상담 시간**: 기본 5분, 최대 20분<br><br>**스트리밍 관리 방식**:<br>• 30초 내외 ~ 최대 1분 세그먼트 단위 관리<br><br>**성능 목표**:<br>• 5초 내 결과<br>• 최소한 **출력1(원문 전사)**은 5초 내 표시                                                                                                                                                                                    |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **3) 출력 정의 (고정)**                  | **출력1 (원문)**:<br>• Streaming STT 결과<br>• Interim(부분 전사) / Final(확정 전사) 구분<br>• 언어 그대로 표시 (ko / en / zh 혼용 가능)<br><br>**출력2 (변환본, 1차 필수 구성)**:<br>• 번역문<br>• 1차 범위: 의사 ko → 환자 en / zh<br>• 용어 글로스(사전 기반, 원문 병기)<br>• 의학용어는 번역하지 않고 원문 유지<br>• 뜻은 별도 카드로 제공<br><br>**모르는 용어 처리**:<br>• 사전에 없거나 확신 없는 용어<br>• 빨간색 표시<br>• 라벨: 확인 필요 |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **4) 모드 설계**                       | **모드 A: 환자 이해 모드**<br>입력: 의사 한국어(+영문 의학용어)<br><br>출력2:<br>• 용어 글로스<br>• (확장 슬롯) 쉬운 말 설명 / 요약<br><br>**모드 B: 외국인 의사소통 모드 (1차 확정)**<br>방향: 의사 ko → 환자 en / zh<br><br>출력2:<br>• 번역문<br>• 용어 글로스<br>• 빨간색 “확인 필요” 용어 표시                                                                                                               |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **5) 품질 정책 (절대 규칙)**               | 정확도 > 안정성 > 자연스러움<br><br>확실하지 않으면:<br>• 억지로 번역 ❌<br>• 경고 + 원문 유지 ⭕                                                                                                                                                                                                                                                                |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **6) 스트리밍 + 세션 운영 규칙 (서버 세션 관리형)** | **세션**:<br>• 최대 20분<br>• 세그먼트 단위 누적 관리<br><br>**네트워크 재시도**:<br>• 스트리밍 중 연결 끊기면 서버가 세션 유지<br>• 자동 재시도<br><br>**UI 표시**:<br>• 연결 끊김 → 재연결 중 (1/3)<br><br>**재시도 실패 시**:<br>• 해당 세그먼트 전사 불완전 처리<br>• warnings에 기록                                                                                                                     |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **7) 전체 아키텍처 (확정)**                | **[Flutter App]**<br>• 마이크 입력<br>• 오디오 스트림 전송<br>• 출력1 / 출력2 UI 표시<br><br>→ **[우리 서버]**<br>• 스트리밍 세션 관리<br>• Google STT Streaming<br>• 사전 기반 용어 매칭<br>• 번역 (ko → en / zh)<br>• Gemini 확장 슬롯<br><br>→ **[응답 이벤트]**<br>• stt_interim<br>• stt_final<br>• transform_ready<br>• warning                                               |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **8) API 계약 (고정)**                 | **POST /session/start**<br>```json<br>{<br>  "mode": "A                                                                                                                                                                                                                                                                           | B",<br>  "source_lang": "ko",<br>  "target_lang": "en | zh",<br>  "department": "plastic_surgery"<br>}<br>`<br><br>**POST /session/{id}/audio**<br>• body: 오디오 스트림 청크<br>• 서버가 STT 스트리밍 세션에 전달<br><br>**이벤트 표준**<br>`json<br>{<br>  "type": "stt_interim | stt_final | transform_ready | warning",<br>  "text": "string",<br>  "segment_id": "string",<br>  "timestamp_ms": 12345<br>}<br>`<br><br>**POST /session/{id}/end**<br>`json<br>{<br>  "output1_transcript": "...",<br>  "output2": {<br>    "translation": "...",<br>    "terms_found": [<br>      {<br>        "term": "rhinoplasty",<br>        "meaning": "코 성형 수술",<br>        "lang": "en"<br>      }<br>    ],<br>    "terms_unknown": [<br>      {<br>        "term": "XYZ",<br>        "reason": "not_in_dictionary"<br>      }<br>    ],<br>    "warnings": []<br>  }<br>}<br>``` |
| **9) A / B / C 역할 (최종)**           | **A (모바일)**<br>• 스트리밍 녹음 / UI<br>• 세션 시작 / 종료<br>• Interim / Final 표시<br>• output1 / output2 화면<br>• 빨간색 “확인 필요” UX<br><br>**B (서버)**<br>• 스트리밍 세션 관리<br>• Google STT 옵션 프리셋<br>• 사전 기반 용어 매칭<br>• 번역 파이프라인<br>• Gemini API 확장 슬롯<br><br>**C (UX/데모)**<br>• 성형외과 시나리오 3개<br>• 외국인 모드 사용 흐름 정리<br>• 약관 / 동의 화면<br>• 발표용 스토리라인      |                                                       |                                                                                                                                                                                                  |           |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
